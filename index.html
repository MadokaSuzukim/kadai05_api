<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BCP App</title>
  <link rel="stylesheet" href="style.css"> 
  <style>
    #myMap {
      position: relative;
      width: 100%;
      height: 400px;
    }
  </style>
   
   <script src="./config.js"></script>
   <script type='text/javascript'>
     function GetMap() {
       // ã“ã“ã§ãƒãƒƒãƒ—ã‚’åˆæœŸåŒ–
     }
   </script>
   <script type='text/javascript'>
     document.addEventListener("DOMContentLoaded", function() {
       var script = document.createElement("script");
       script.src = 'https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=' + config.BING_MAPS_API_KEY;
       script.async = true;
       script.defer = true;
       document.body.appendChild(script);
     });
   </script>

<script type='text/javascript'>
   let map;
    function GetMap() {
    var map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
        center: new Microsoft.Maps.Location(34.618644, 135.7859943),
        mapTypeId: Microsoft.Maps.MapTypeId.canvasLight,
        zoom: 11
    });
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ä½ç½®ã‚’å–å¾—
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            // ã“ã“ã§locå¤‰æ•°ã‚’å®šç¾©
            var loc = new Microsoft.Maps.Location(position.coords.latitude, position.coords.longitude);

            // ç¾åœ¨åœ°ã«ãƒ”ãƒ³ã‚’ç«‹ã¦ã‚‹
            var pin = new Microsoft.Maps.Pushpin(loc);
            map.entities.push(pin);

            // åœ°å›³ã®ä¸­å¿ƒã‚’ç¾åœ¨åœ°ã«è¨­å®š
            map.setView({ center: loc, zoom: 10 });
        }, function(error) {
            console.error('Geolocation error: ', error);
        });
    } else {
        alert("Geolocation APIã¯ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
    }
    
    // è¨ªå•çœ‹è­·ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€Œã¾ã‚‹ã¾ã‚‹ã€ã®ä½ç½®ã«ãƒ”ãƒ³ã‚’ç«‹ã¦ã‚‹
    const marumaruLocation = new Microsoft.Maps.Location(34.618644, 135.7859943);
    const marumaruPin = new Microsoft.Maps.Pushpin(marumaruLocation, {
        text: 'ã¾ã‚‹ã¾ã‚‹'
    });
    map.entities.push(marumaruPin);

    // ä»®ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ï¼ˆä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¾ãŸã¯Firebaseã‹ã‚‰ã®å–å¾—ï¼‰
const username = "ãƒ¦ãƒ¼ã‚¶ãƒ¼å"; // å®Ÿéš›ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¾ãŸã¯Firebaseã‹ã‚‰å–å¾—ã—ãŸå€¤ã‚’ä½¿ç”¨ã—ã¾ã™

// ç¾åœ¨åœ°ã«ãƒ”ãƒ³ã‚’ç«‹ã¦ã‚‹éš›ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’è¡¨ç¤º
const userPin = new Microsoft.Maps.Pushpin(loc, { text: username }); // 'ç¾åœ¨åœ°'ã®ä»£ã‚ã‚Šã«usernameã‚’ä½¿ç”¨
map.entities.push(userPin);

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦Firebaseã«ä¿å­˜ã™ã‚‹
navigator.geolocation.getCurrentPosition(function(position) {
    const userLocation = {
        lat: position.coords.latitude,
        lng: position.coords.longitude,
        timestamp: new Date().toISOString() // æ›´æ–°æ™‚é–“
    };

    // ä»®å®šï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ ã‚’æ—¢ã«æŒã£ã¦ã„ã‚‹ã¨ã—ã¾ã™
    const userId = "ãƒ¦ãƒ¼ã‚¶ãƒ¼ID"; // å®Ÿéš›ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯å‹•çš„ã«è¨­å®š

    // Firebaseã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®æƒ…å ±ã‚’ä¿å­˜
    set(ref(db, 'users/' + userId), userLocation);
});

const usersRef = ref(db, 'users');

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®æƒ…å ±ã®å¤‰æ›´ã‚’ãƒªã‚¹ãƒ³
onValue(usersRef, (snapshot) => {
    snapshot.forEach((childSnapshot) => {
        const userId = childSnapshot.key;
        const userLocation = childSnapshot.val();

        // åœ°å›³ä¸Šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ”ãƒ³ã‚’æ›´æ–°ã™ã‚‹å‡¦ç†
        updateMapWithUserLocation(userId, userLocation);
    });
});

function updateMapWithUserLocation(userId, userLocation) {
    // åœ°å›³ä¸Šã§userIdã«å¯¾å¿œã™ã‚‹ãƒ”ãƒ³ã‚’æ¢ã™
    // ãƒ”ãƒ³ãŒè¦‹ã¤ã‹ã‚Œã°ã€ãã®ä½ç½®ã¨æƒ…å ±ã‚’æ›´æ–°
    // ãƒ”ãƒ³ãŒãªã‘ã‚Œã°ã€æ–°ã—ã„ãƒ”ãƒ³ã‚’ä½œæˆ

    const loc = new Microsoft.Maps.Location(userLocation.lat, userLocation.lng);
    const pin = new Microsoft.Maps.Pushpin(loc, {
        title: userId, // ã¾ãŸã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒãƒ¼ãƒ 
        subTitle: `æ›´æ–°æ™‚é–“: ${userLocation.timestamp}` // æ›´æ–°æ™‚é–“ã‚’ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦è¡¨ç¤º
    });

    // åœ°å›³ä¸Šã«ãƒ”ãƒ³ã‚’è¿½åŠ ã¾ãŸã¯æ›´æ–°
    map.entities.push(pin); // æ—¢å­˜ã®ãƒ”ãƒ³ã®æ›´æ–°ã¾ãŸã¯æ–°è¦ãƒ”ãƒ³ã®è¿½åŠ 
}
        // ç¾åœ¨åœ°ã‚’å–å¾—ã—ã¦ãƒ”ãƒ³ã‚’ç½®ã
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(function(position) {
              const loc = new Microsoft.Maps.Location(
                  position.coords.latitude,
                  position.coords.longitude
              );

              // ç¾åœ¨åœ°ã«ãƒ”ãƒ³ã‚’ç«‹ã¦ã‚‹
              const pin = new Microsoft.Maps.Pushpin(loc, { text: 'ç¾åœ¨åœ°' });
              map.entities.push(pin);

              // ã‚¤ãƒ³ãƒ•ã‚©ãƒœãƒƒã‚¯ã‚¹ã«ç¾åœ¨åœ°æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹
              const infobox = new Microsoft.Maps.Infobox(loc, {
                  title: 'ã‚ãªãŸã¯ã“ã“ã«ã„ã¾ã™',
                  description: 'ã“ã‚ŒãŒã‚ãªãŸã®ç¾åœ¨åœ°ã§ã™ã€‚',
                  visible: true
              });

              infobox.setMap(map);

              // ãƒãƒƒãƒ—ã‚’ç¾åœ¨åœ°ã«ç§»å‹•
              map.setView({ center: loc });
          }, function(error) {
              console.error('Geolocation error: ', error);
          }, {
              enableHighAccuracy: true,
              timeout: 5000,
              maximumAge: 0
          });
      } else {
          alert("ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã¯ä½ç½®æƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚");
      }
    }
  
    </script>
</script>
   <!-- è¨­å®šå†…å®¹ -->
</head>
<body>
    <header>
        <h1>è¨ªå•çœ‹è­·ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¾ã‚‹ã¾ã‚‹</h1>
        <h1>BCPã‚·ã‚¹ãƒ†ãƒ </h1>
        <p>å€‹åˆ¥æ”¯æ´è¨ˆç”»ã«åŸºã¥ãã€ç·Šæ€¥è¨“ç·´æ™‚ã¨ç½å®³æ™‚ã«ã¯ã“ã¡ã‚‰ã‚’åˆ©ç”¨ã—ã¾ã™</p>
<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
<div id="myMap" style="position:relative;width:600px;height:400px;"></div>
    
<h2>å®‰å¦ç¢ºèªé€ä¿¡æ¬„</h2>
<div>
    åå‰ï¼š<input type="text" id="uname"> 
    æ—¥ä»˜ï¼š<input type="date" id="day">
</div>
<div>
    <textarea id="text" cols="30" rows="10"></textarea>
    <button id="send">é€ä¿¡</button>
</div>
<div id="output" style="overflow: auto;height: auto;"></div>
<h1>BCPç™ºä»¤æ™‚ã®å¯¾å¿œã«ã¤ã„ã¦</h1>
<div class="section-sengen">ã“ã®BCPã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦</div>
        <div class="section-sengent">
          <p>ç½å®³æ™‚ã®BCPï¼ˆBusiness Continuity Planï¼šäº‹æ¥­ç¶™ç¶šè¨ˆç”»ï¼‰ç™ºä»¤æ™‚ã«ã€ç¾åœ¨åœ°ã‚’åŸºã«ã—ãŸåœ°å›³ã‚’ä½¿ç”¨ã—ã¦å®‰å¦ç¢ºèªã‚’è¡Œã†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
            </p>
            <p>åœ°åŸŸBCPãŒã‚ã£ãŸã‚‰
                é¿é›£æ‰€ã«åŒ»ç™‚å¾“äº‹è€…ãŒä½•äººã‹ãŠã‚‹ã¯ãšãã“ã§ç›¸è«‡ã—ã¦ã­</p>
            <p>1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®æƒ…å ±ã®å–å¾—ã¨å…±æœ‰
                ä½ç½®æƒ…å ±ã®å–å¾—: HTML5 Geolocation APIãªã©ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ä½ç½®ã‚’å–å¾—ã—ã¾ã™ã€‚
                ä½ç½®æƒ…å ±ã®å…±æœ‰: å–å¾—ã—ãŸä½ç½®æƒ…å ±ã‚’å®‰å…¨ãªã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜ã—ã€å¿…è¦ã«å¿œã˜ã¦è¡Œæ”¿ã‚„æ•‘åŠ©æ©Ÿé–¢ã¨å…±æœ‰ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
                2. ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ç¢ºä¿
                åŒæ„ã®å–å¾—: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ä½ç½®æƒ…å ±ã®å–å¾—ã¨å…±æœ‰ã«é–¢ã™ã‚‹åŒæ„ã‚’æ˜ç¤ºçš„ã«å–å¾—ã—ã¾ã™ã€‚
                ãƒ‡ãƒ¼ã‚¿ä¿è­·: é€ä¿¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã¯æš—å·åŒ–ã—ã€ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã‹ã‚‰ä¿è­·ã—ã¾ã™ã€‚
                3. è¡Œæ”¿ã¨ã®é€£æºæ–¹æ³•ã®ç¢ºç«‹
                å…±æœ‰ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã®ç¢ºç«‹: è¡Œæ”¿ã‚„æ•‘åŠ©æ©Ÿé–¢ã¨ã®é–“ã§ã€ä½ç½®æƒ…å ±ã‚„å®‰å¦æƒ…å ±ã‚’ã©ã®ã‚ˆã†ã«å…±æœ‰ã™ã‚‹ã‹ã€ã‚ã‚‰ã‹ã˜ã‚å”è­°ã—ã¦ãŠãã“ã¨ãŒé‡è¦ã§ã™ã€‚
                æ¨™æº–ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä½¿ç”¨: æƒ…å ±äº¤æ›æ™‚ã«ã¯ã€å…±é€šã®ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆä¾‹ãˆã°ã€CAPï¼šCommon Alerting Protocolï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€äº’æ›æ€§ã®å•é¡Œã‚’é¿ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
                4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å·¥å¤«
                ç›´æ„Ÿçš„ãªæ“ä½œ: ç½å®³æ™‚ã«ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¹ãƒˆãƒ¬ã‚¹ãŒé«˜ã¾ã‚‹ãŸã‚ã€ã‚·ãƒ³ãƒ—ãƒ«ã§ç›´æ„Ÿçš„ã«æ“ä½œã§ãã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚
                å¤šè¨€èªå¯¾å¿œ: ç½å®³ç™ºç”Ÿåœ°åŸŸã«ã‚ˆã£ã¦ã¯ã€å¤šè¨€èªã«å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
                5. ã‚·ã‚¹ãƒ†ãƒ ã®è€éšœå®³æ€§
                å†—é•·æ€§ã®ç¢ºä¿: ã‚µãƒ¼ãƒãƒ¼ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å†—é•·æ§‹æˆã‚’å–ã‚Šã€ä¸€éƒ¨ãŒæ•…éšœã—ã¦ã‚‚ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ãŒåœæ­¢ã—ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
                ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒåˆ©ç”¨ã§ããªã„çŠ¶æ³ã§ã‚‚ã€ã‚ã‚‹ç¨‹åº¦ã®æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã‚ˆã†ã«ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œã‚’æ¤œè¨ã—ã¾ã™ã€‚
                6. ãƒ†ã‚¹ãƒˆã¨è¨“ç·´
                å®šæœŸçš„ãªãƒ†ã‚¹ãƒˆ: ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’å®šæœŸçš„ã«ãƒ†ã‚¹ãƒˆã—ã€ç½å®³æ™‚ã«å³å¿œã§ãã‚‹çŠ¶æ…‹ã‚’ç¶­æŒã—ã¾ã™ã€‚
                è¨“ç·´ã®å®Ÿæ–½: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚„é–¢ä¿‚æ©Ÿé–¢ã¨å”åŠ›ã—ã¦ã€å®šæœŸçš„ã«è¨“ç·´ã‚’è¡Œã„ã€å®Ÿéš›ã®ç½å®³æ™‚ã®å¯¾å¿œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¾ã™ã€‚
                ã“ã®ã‚ˆã†ãªã‚·ã‚¹ãƒ†ãƒ ã‚’æ§‹ç¯‰ã™ã‚‹ã«ã¯ã€æŠ€è¡“çš„ãªå®Ÿè£…ã ã‘ã§ãªãã€æ³•å¾‹ã‚„ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®å•é¡Œã€è¡Œæ”¿ã‚„æ•‘åŠ©æ©Ÿé–¢ã¨ã®é€£æºãªã©ã€å¤šå²ã«ã‚ãŸã‚‹æ¤œè¨ãŒå¿…è¦ã§ã™ã€‚ã—ã‹ã—ã€ã—ã£ã‹ã‚Šã¨è¨ˆç”»ã—å®Ÿè£…ã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ã¯ã€ç½å®³æ™‚ã«ãŠã‘ã‚‹äººå‘½æ•‘åŠ©ã‚„æƒ…å ±å…±æœ‰ã®å¤§ããªåŠ›ã¨ãªã‚‹ã§ã—ã‚‡ã†ã€‚</p>
        </div>
        <div class="section-sengen">è¨ªå•çœ‹è­·ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¾ã‚‹ã¾ã‚‹ã«ã¤ã„ã¦</div>
        <div class="section-sengent">
          <p>::::::::
            </p>
            <p>::::::</p>
            <p>:::::</p>
<!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->


<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- [ MapTypeId ] https://msdn.microsoft.com/en-us/library/mt712700.aspx -->
<!-- <script src='https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key=Aoz9fWxOSduCa4Q9RpKVldht9VjioGUOBUibc79YYA1R7XJLv7J3beRaKi0Aom01' async defer></script> -->
<div id="myMap" style="position:relative;width:600px;height:400px;"></div>
   
<!--** ä»¥ä¸‹Firebase **-->
<script type="module">
// firebaseAPIkey.jsã‹ã‚‰ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«
import firebaseConfig from "./firebaseAPIkey.js";
    // Import the functions you need from the SDKs you need
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getAuth, RecaptchaVerifier, signInWithPhoneNumber } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
import { getDatabase, set,ref, push,onChildAdded, onChildRemoved,onChildChanged} from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);//RealtimeDBã«æ¥ç¶š
    const dbRef = ref(db, "chat"); // ä¾‹: 'chat'ãƒ‘ã‚¹ã¸ã®å‚ç…§
    const auth = getAuth(app);
    const database = getDatabase(app); // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å–å¾—


//  // é€ä¿¡
$("#send").on("click", function () {
  const msg = {
      uname: $("#uname").val(),
      // day: $("#day").val(),
      text: $("#text").val(),
      datetime: formattedDateTime // æŒ‡å®šã—ãŸå½¢å¼ã§æ—¥æ™‚ã‚’è¿½åŠ 
      // datetime: new Date().toISOString() // ç¾åœ¨ã®æ—¥æ™‚ã‚’ISOå½¢å¼ã§å–å¾—ã—ã€datetimeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«è¿½åŠ 
  }
  // console.log(msg); //ãƒã‚§ãƒƒã‚¯ã—ãŸã‚‰æ¶ˆã™
  const newPostRef = push(dbRef); // ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã‚’ç”Ÿæˆ
  set(newPostRef, msg); // "chat"ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ã¤ã‘ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²
  console.log(newPostRef);//ã“ã‚Œã‚’ã¿ãŸã‚‰ã€ã©ã†ã„ã†å‡¦ç†ãªã‚“ã‹ã‚ã‹ã‚‹ï¼
});

  // å—è¨º
  // ã‚«ãƒ†ã‚´ãƒªãƒ¼æƒ…å ±ã‚’å—ä¿¡ã™ã‚‹
  onChildAdded(dbRef, function (data) {
  const msg = data.val();
  const key = data.key; // ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼
  let h = '<p id="' + key + '">'; // ã‚«ãƒ†ã‚´ãƒªãƒ¼æƒ…å ±ã¯ã“ã“ã§ã¯ä½¿ç”¨ã—ãªã„
  h += msg.uname + " ";
  if (msg.datetime) { // datetime ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿æ™‚é–“ã‚’è¡¨ç¤º
      h += msg.datetime + " ";
  }
  h += '<span contentEditable="true" id="' + key + '_update">' + msg.text + '</span>';
  h += '<span class="remove" data-key="' + key + '">ğŸš®</span>';
  h += '<span class="update" data-key="' + key + '">ğŸ†™</span>';
  h += '</p>';
  $("#output").prepend(h);
});

// å‰Šé™¤ã‚¤ãƒ™ãƒ³ãƒˆ
$("#output").on("click", ".remove", function () {
  const key = $(this).attr("data-key");
  const remove_item = ref(db, "chat/" + key); // å‚ç…§å…ˆã‚’ä¿®æ­£
  remove(remove_item); //Firebaseãƒ‡ãƒ¼ã‚¿å‰Šé™¤é–¢æ•°
});

// æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆ
$("#output").on("click", ".update", function () {
  const key = $(this).attr("data-key");
  update(ref(db, "chat/" + key), {
      text: $("#" + key + '_update').html()
  });
});

// å‰Šé™¤å‡¦ç†ãŒFirebaseå´ã§å®Ÿè¡Œã•ã‚ŒãŸã‚‰
onChildRemoved(dbRef, (data) => {
  $("#" + data.key).remove(); //DOMæ“ä½œé–¢æ•°ï¼ˆå¯¾è±¡ã‚’å‰Šé™¤ï¼‰
});

// æ›´æ–°å‡¦ç†ãŒFirebaseå´ã§å®Ÿè¡Œã•ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼
onChildChanged(dbRef, (data) => {
  $("#" + data.key + '_update').html(data.val().text);
  $("#" + data.key + '_update').fadeOut(800).fadeIn(800);
});

const currentDate = new Date();
const year = currentDate.getFullYear();
const month = String(currentDate.getMonth() + 1).padStart(2, '0');
const day = String(currentDate.getDate()).padStart(2, '0');
const hours = String(currentDate.getHours()).padStart(2, '0');
const minutes = String(currentDate.getMinutes()).padStart(2, '0');
const seconds = String(currentDate.getSeconds()).padStart(2, '0');
const formattedDateTime = `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;



</script>
<footer>
  <small>è¨ªå•çœ‹è­·ã‚¹ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¾ã‚‹ã¾ã‚‹</small>
</footer>
<script src="main.js"></script>
</body>
</html>
